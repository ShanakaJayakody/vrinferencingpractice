<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCAT VR Practice - MedwithPurpose</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Custom styles for better UI/UX */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrolling on body */
            font-family: 'Inter', sans-serif;
        }

        /* --- REDESIGNED THEMES --- */
        .theme-background {
            background-color: #f0f2f5;
        }

        #setup-screen, #results-screen {
            background: linear-gradient(170deg, #c7d2fe 0%, #f0f2f5 50%, #b0bec5 100%);
        }

        .card {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
        }

        .primary-button-new {
            background-image: linear-gradient(135deg, #4f46e5, #6366f1);
            color: white;
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
            font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
        }
        .primary-button-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
            background-image: linear-gradient(135deg, #4338ca, #4f46e5);
        }

        .secondary-button-new {
            background-color: transparent;
            color: #4353ff;
            border: 1px solid #4353ff;
            transition: all 0.3s ease;
             font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
        }
        .secondary-button-new:hover {
            background-color: rgba(67, 83, 255, 0.1);
            transform: translateY(-2px);
        }

        input.themed-input {
            background-color: #f0f2f5;
            border: 1px solid #d1d5db;
            color: #1f2937;
        }
        input.themed-input:focus {
            border-color: #4353ff;
            box-shadow: 0 0 0 2px rgba(67, 83, 255, 0.2);
            outline: none;
        }

        /* --- Original Test Environment Styles --- */
        #app-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 2rem);
            width: 100%;
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 0.375rem;
            margin: 1rem;
            overflow: hidden;
        }
        .header-bar, .footer-bar {
            flex-shrink: 0;
            background-color: #006DAA;
            color: white;
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-bar span, .header-bar div { color: white; }
        #timer { background-color: rgba(255, 255, 255, 0.2); color: white; font-weight: bold; padding: 0.25rem 0.75rem; border-radius: 0.25rem; }
        .footer-bar button, .font-size-button { background-color: transparent; color: white; border: 1px solid rgba(255, 255, 255, 0.5); padding: 0.4rem 0.8rem; font-size: 0.8rem; border-radius: 0.375rem; transition: background-color 0.2s ease, border-color 0.2s ease; }
        .font-size-button { padding: 0.2rem 0.6rem; font-weight: bold; line-height: 1.25; }
        .footer-bar button:hover:not(:disabled), .font-size-button:hover:not(:disabled) { background-color: rgba(255, 255, 255, 0.15); border-color: white; }
        .footer-bar button:disabled { opacity: 0.5; cursor: not-allowed; border-color: rgba(255, 255, 255, 0.3); }
        .footer-bar button#next-button { background-color: #ffffff; color: #006DAA; border: 1px solid white; font-weight: 500; }
        .footer-bar button#next-button:hover:not(:disabled) { background-color: #f0f0f0; }
        #flag-button { background-color: transparent; border: 1px solid white; color: white; transition: background-color 0.2s ease, color 0.2s ease; }
        #flag-button:hover { background-color: white; color: #006DAA; }
        #flag-button.flagged { background-color: #facc15; border-color: #facc15; color: #422006; }
        #flag-button.flagged:hover { background-color: #f59e0b; border-color: #f59e0b; }

        .main-content-area { flex-grow: 1; display: flex; overflow: hidden; padding: 1rem; gap: 1rem; }
        
        /* UPDATED: Column widths changed to 60/40 split */
        .passage-column {
            flex: 0 0 60%;
            overflow-y: auto; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.375rem; background-color: #ffffff; height: 100%; transition: font-size 0.2s ease;
        }
        .question-column {
            flex: 0 0 40%;
            overflow-y: auto; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.375rem; background-color: #ffffff; height: 100%; transition: font-size 0.2s ease;
            position: relative;
        }

        .selected-answer { background-color: #bfdbfe !important; border-color: #3b82f6 !important; }
        .nav-answered { background-color: #a7f3d0; }
        .nav-current { border: 2px solid #3b82f6 !important; font-weight: bold; }
        .nav-flagged, .review-flagged { border: 2px solid #f59e0b !important; position: relative; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 0.5rem; }
        .modal.flex { display: flex; }

        .option-label { display: block; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; margin-bottom: 0.5rem; cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease; background-color: #ffffff; color: #111827; }
        .option-label:hover:not(.selected-answer) { background-color: #f3f4f6; border-color: #a5b4fc; }
        input[type="radio"] { display: none; }
        .resizable-text { font-size: 1rem; }

        .explanation-box { background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 0.5rem 0.75rem; margin-top: 0.75rem; border-radius: 0.375rem; color: #111827; }

        .review-grid-button { padding: 0.5rem 0.25rem; border: 1px solid #d1d5db; border-radius: 0.375rem; text-align: center; transition: background-color 0.2s ease, border-color 0.2s ease; font-size: 0.875rem; line-height: 1.25rem; cursor: pointer; }
        .review-grid-button-answered { background-color: #dcfce7; border-color: #86efac; color: #15803d; }
        .review-grid-button-unanswered { background-color: #f3f4f6; border-color: #d1d5db; color: #4b5563; }
        .review-grid-button:hover { filter: brightness(95%); }

        /* Results Screen Grid */
        #results-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 0.75rem; padding: 1rem 0; width: 100%; }
        .result-box { display: flex; flex-direction: column; align-items: center; justify-content: center; aspect-ratio: 1 / 1; padding: 0.25rem; border-radius: 0.5rem; color: white; text-align: center; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: 100%; height: auto; border: none; }
        .result-box:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        
        .result-box-correct {
            background: linear-gradient(145deg, #22c55e, #15803d);
        }
        .result-box-incorrect {
            background: linear-gradient(145deg, #ef4444, #b91c1c);
        }
        .result-box-flagged { outline: 3px solid #f59e0b; outline-offset: 2px; }
        .result-box .time-spent { font-size: 1rem; font-weight: 600; line-height: 1.1; }
        .question-num-label { font-size: 0.75rem; color: #4b5563; text-align: center; width: 100%; margin-top: 0.25rem; }

        @media (max-width: 768px) {
            #app-container { height: auto; margin: 0.5rem; }
            .main-content-area { flex-direction: column; padding: 0.5rem; gap: 0.5rem; }
            .passage-column, .question-column { flex-basis: auto; width: 100%; } /* Reverts to block-level stacking on mobile */
            .header-bar, .footer-bar { padding: 0.5rem 1rem; }
            .header-bar span, .footer-bar button, .font-size-button { font-size: 0.8rem; }
            #review-grid { grid-template-columns: repeat(5, minmax(0, 1fr)); }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    </head>
<body class="theme-background">

    <div id="app-container" class="!border-none !shadow-none !m-0 !rounded-none">

        <div id="setup-screen" class="p-4 md:p-8 flex flex-col justify-center items-center h-full w-full">
            <div class="w-full max-w-lg text-center">
                <img src="https://ik.imagekit.io/mwp/MWP%20Color%20no%20background.png?updatedAt=1745982959141"
                     alt="MedwithPurpose Logo"
                     class="mx-auto h-24 w-auto mb-6"
                     onerror="this.style.display='none'; this.onerror=null;">
                <div class="card p-8 md:p-10">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Verbal Reasoning Practice</h1>
                    <p class="text-gray-600 mt-2 text-lg mb-8">Sharpen your skills for the UCAT VR section.</p>
                    <div class="text-left space-y-3 mb-8 bg-blue-50/50 border border-blue-200/50 rounded-lg p-4">
                        <p class="text-sm text-gray-800"><strong class="font-semibold">Questions:</strong> <span id="setup-question-count">16</span></p>
                        <p class="text-sm text-gray-800"><strong class="font-semibold">Time Limit:</strong> <span id="setup-time-limit">9 minutes</span></p>
                    </div>

                    <div class="space-y-6 text-left">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                            <input type="text" id="name" name="name" class="themed-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Enter your name">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="goal" class="block text-sm font-medium text-gray-700 mb-1">Score Goal</label>
                                <input type="number" id="goal" name="goal" min="0" max="16" class="themed-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none sm:text-sm" placeholder="e.g., 12">
                            </div>
                            <div>
                                <label for="focus-area" class="block text-sm font-medium text-gray-700 mb-1">Practice Intention</label>
                                <input type="text" id="focus-area" name="focus-area" class="themed-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none sm:text-sm" placeholder="e.g., Speed, Accuracy">
                            </div>
                        </div>
                    </div>

                    <div class="mt-10">
                        <button id="start-button" class="primary-button-new w-full text-lg">
                            Start Exam
                        </button>
                    </div>
                </div>
            </div>
        </div>


        <div id="exam-screen" class="hidden flex flex-col h-full">
            <div class="header-bar">
                <span id="exam-title" class="font-semibold">Verbal Reasoning</span>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <button id="font-decrease-button" class="font-size-button">A-</button>
                        <button id="font-increase-button" class="font-size-button">A+</button>
                    </div>
                    <div id="timer" class="text-base px-3 py-1 rounded-md">9:00</div>
                    <span class="text-sm">Question <span id="question-number-info">1</span> of 16</span>
                    <button id="flag-button" class="text-sm font-medium border border-white rounded px-2 py-1 transition-colors duration-150">
                         Flag for Review
                    </button>
                </div>
            </div>
            <div class="main-content-area">
                <div class="passage-column resizable-text">
                    <h3 class="text-lg font-semibold mb-2 sticky top-0 bg-white text-gray-900 pb-1">Passage <span id="passage-number">1</span></h3>
                    <div id="passage-text" class="text-base text-gray-900 leading-relaxed whitespace-pre-wrap"></div>
                </div>
                <div class="question-column resizable-text">
                     <h4 class="text-md font-semibold mb-3 sticky top-0 bg-white text-gray-900 pb-1">Question <span id="question-number">1</span></h4>
                    <p id="question-text" class="mb-4 text-gray-900"></p>
                    <div id="options-container" class="space-y-2"></div>
                    <div id="review-explanation-container"></div>
                </div>
            </div>
            <div class="footer-bar">
                <button id="back-to-results-button" class="hidden mr-auto">← Back to Results</button>
                <button id="end-exam-button-footer">End Exam</button>
                <div class="flex items-center space-x-2 ml-auto">
                    <button id="prev-button" disabled>← Previous (Alt+P)</button>
                    <button id="navigator-button">Navigator</button>
                    <button id="next-button">Next (Alt+N) →</button>
                </div>
            </div>
        </div>

        <div id="review-screen" class="hidden p-6 md:p-8 flex-col items-center h-full overflow-y-auto bg-gray-50">
             <div class="w-full max-w-3xl mb-4 flex justify-between items-center">
                 <h2 class="text-2xl font-bold text-gray-900">Review Your Answers</h2> <button id="filter-flagged-button" class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-100">Show Flagged Only</button>
            </div>
             <p class="text-center text-gray-600 mb-6">Click on a question number to review it. Green indicates answered, Yellow border indicates flagged.</p>
             <div id="review-grid" class="grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-10 gap-3 mb-6 w-full max-w-3xl"></div>
            <div class="mt-auto pt-6">
                <button id="end-exam-button" class="bg-red-600 text-white hover:bg-red-700 text-lg px-8 py-3 rounded-md">
                    End Exam & See Results
                </button>
            </div>
        </div>


        <div id="results-screen" class="hidden p-4 md:p-8 flex-col h-full overflow-y-auto w-full">
            <div class="w-full max-w-4xl mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Exam Results</h2>
                    <p class="text-gray-600 mt-2">Here's a breakdown of your performance.</p>
                </div>

                <div class="card p-8 mb-8 text-center">
                    <p class="text-lg text-gray-600 mb-2">Your Score</p>
                    <p class="text-6xl font-bold text-gray-900"><span id="score">0</span><span class="text-4xl text-gray-500"> / <span id="total-questions-results">16</span></span></p>
                    <div class="mt-4 h-1 w-24 bg-indigo-200 mx-auto rounded-full"></div>
                    <p class="mt-4 text-md text-gray-500">Time Taken: <span id="time-taken" class="font-semibold"></span></p>
                </div>

                <div class="grid md:grid-cols-5 gap-8 mb-8">
                    <div class="md:col-span-2 space-y-8">
                        <div class="card p-6">
                            <h4 class="text-lg font-semibold mb-3 text-center text-gray-800">Time Analysis</h4>
                            <div id="time-analysis-results" class="space-y-2 text-sm text-gray-600"></div>
                        </div>
                        <div class="card p-6">
                            <h4 class="text-lg font-semibold mb-3 text-center text-gray-800">Performance by Type</h4>
                            <div id="type-analysis-results" class="space-y-2 text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <div class="md:col-span-3 card p-6">
                         <h3 class="text-lg font-semibold mb-1 text-gray-800">Detailed Results</h3>
                         <p class="text-sm text-gray-500 mb-4">Click a box to review the question.</p>
                         <div id="results-grid-container"></div>
                    </div>
                </div>

                <div class="card p-8 mb-8">
                    <h3 class="text-xl font-semibold mb-6 text-gray-800">Reflection</h3>
                    <div class="space-y-6">
                        <div>
                            <label for="reflection-q1" class="block text-md font-semibold text-gray-700 mb-2">Which question type was most challenging, and why?</label>
                            <textarea id="reflection-q1" rows="3" class="themed-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm" placeholder="e.g., Inference questions were tricky because..."></textarea>
                        </div>
                        <div>
                            <label for="reflection-q2" class="block text-md font-semibold text-gray-700 mb-2">Which question took you the longest, and why?</label>
                            <textarea id="reflection-q2" rows="3" class="themed-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm" placeholder="e.g., Question 7 took a while because I had to re-read the passage..."></textarea>
                        </div>
                        <div>
                            <label for="reflection-q3" class="block text-md font-semibold text-gray-700 mb-2">Did you stick to your 'Practice Intention'? If not, what distracted you?</label>
                            <textarea id="reflection-q3" rows="3" class="themed-input block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm" placeholder="I wanted to focus on speed, but got bogged down in the details..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="text-center flex justify-center items-center space-x-4">
                    <button onclick="window.location.reload()" class="secondary-button-new">
                        Try Again
                    </button>
                    <button id="download-pdf-button" class="primary-button-new">
                        Download Results PDF
                    </button>
                </
